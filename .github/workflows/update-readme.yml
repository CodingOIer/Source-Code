name: Update README Stats

on:
  schedule:
    - cron: '0 0 * * *' # 每天 UTC 0:00 对应北京时间 8:00
  workflow_dispatch: # 允许手动触发

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: 检出代码库
        uses: actions/checkout@v4

      - name: 统计代码行数和字符数
        run: |
          lines=$(find . -type f -name "*.py" -o -name "*.js" -o -name "*.md" -o -name "*.cpp" -o -name "*.java" | xargs wc -l | awk '{s+=$1} END {print s}')
          chars=$(find . -type f -name "*.py" -o -name "*.js" -o -name "*.md" -o -name "*.cpp" -o -name "*.java" | xargs wc -m | awk '{s+=$1} END {print s}')
          sed -e "s/{line}/$lines/" -e "s/{char}/$chars/" README.template.md > README.md

      - name: 提交更新
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m ":hammer: 更新 README 统计信息"
          git push
